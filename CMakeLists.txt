cmake_minimum_required(VERSION 3.0.2)
 
project(GLEngineSuperbuild)

include(ExternalProject)

set(GLEngine_CMAKE_DIR "${CMAKE_SOURCE_DIR}/CMake")
set(3RDPARTY_SRC_DIR "${CMAKE_SOURCE_DIR}/3rdparty")
set(3RDPARTY_BINARY_DIR "${CMAKE_BINARY_DIR}/3rdparty")
set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${GLEngine_CMAKE_DIR})
set(CMAKE_INSTALL_PREFIX ${CMAKE_BINARY_DIR}/install CACHE PATH "Install location" FORCE)
set(CMAKE_PREFIX_PATH ${CMAKE_INSTALL_PREFIX})

# Add submodules
ExternalProject_Add(GLEW
	PREFIX           "${3RDPARTY_BINARY_DIR}/GLEW"
	SOURCE_DIR       "3rdparty/GLEW/src"
	BINARY_DIR       "3rdparty/GLEW/build"
	INSTALL_DIR      "install"
	DOWNLOAD_COMMAND ${CMAKE_COMMAND} -E copy_directory "${3RDPARTY_SRC_DIR}/GLEW" "${3RDPARTY_BINARY_DIR}/GLEW/src"
	CMAKE_ARGS
		-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_PREFIX_PATH}
		-Dglew-cmake_BUILD_STATIC:BOOL=FALSE
		-Dglew-cmake_BUILD_SHARED:BOOL=TRUE
		-DONLY_LIBS:BOOL=TRUE)
	
ExternalProject_Add(GLFW
	PREFIX           "${3RDPARTY_BINARY_DIR}/GLFW"
	SOURCE_DIR       "3rdparty/GLFW/src"
	BINARY_DIR       "3rdparty/GLFW/build"
	INSTALL_DIR      "install"
	DOWNLOAD_COMMAND ${CMAKE_COMMAND} -E copy_directory "${3RDPARTY_SRC_DIR}/GLFW" "${3RDPARTY_BINARY_DIR}/GLFW/src"
	CMAKE_ARGS
		-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_PREFIX_PATH}
		-DBUILD_SHARED_LIBS:BOOL=TRUE
		-DGLFW_BUILD_DOCS:BOOL=FALSE
		-DGLFW_BUILD_EXAMPLES:BOOL=FALSE
		-DGLFW_BUILD_TESTS:BOOL=FALSE)
		
ExternalProject_Add(GLM
	PREFIX           "${3RDPARTY_BINARY_DIR}/GLM"
	SOURCE_DIR       "3rdparty/GLM/src"
	BINARY_DIR       "3rdparty/GLM/build"
	INSTALL_DIR      "install"
	DOWNLOAD_COMMAND ${CMAKE_COMMAND} -E copy_directory "${3RDPARTY_SRC_DIR}/GLM" "${3RDPARTY_BINARY_DIR}/GLM/src"
	CMAKE_ARGS
		-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_PREFIX_PATH}
		-DBUILD_SHARED_LIBS:BOOL=TRUE
		-DBUILD_STATIC_LIBS:BOOL=FALSE
		-DGLM_TEST_ENABLE:BOOL=FALSE)
	
ExternalProject_Add(assimp
	PREFIX           "${3RDPARTY_BINARY_DIR}/assimp"
	SOURCE_DIR       "3rdparty/assimp/src"
	BINARY_DIR       "3rdparty/assimp/build"
	INSTALL_DIR      "install"
	DOWNLOAD_COMMAND ${CMAKE_COMMAND} -E copy_directory "${3RDPARTY_SRC_DIR}/assimp" "${3RDPARTY_BINARY_DIR}/assimp/src"
	CMAKE_ARGS
		-DTBB_BUILD_TESTS:BOOL=FALSE
		-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_PREFIX_PATH}
		-DASSIMP_BUILD_ASSIMP_TOOLS:BOOL=FALSE
		-DASSIMP_BUILD_TESTS:BOOL=FALSE)

ExternalProject_Add(Eigen
	PREFIX           "${3RDPARTY_BINARY_DIR}/Eigen"
	SOURCE_DIR       "3rdparty/Eigen/src"
	BINARY_DIR       "3rdparty/Eigen/build"
	INSTALL_DIR      "install"
	DOWNLOAD_COMMAND ${CMAKE_COMMAND} -E copy_directory "${3RDPARTY_SRC_DIR}/Eigen" "${3RDPARTY_BINARY_DIR}/Eigen/src"
	CMAKE_ARGS
		-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_PREFIX_PATH}
		-DBUILD_TESTING:BOOL=FALSE)

ExternalProject_Add(GLEngine
	DEPENDS          GLEW GLFW assimp Eigen
	SOURCE_DIR       ${CMAKE_SOURCE_DIR}/src
	BINARY_DIR       "Innerbuild"
	INSTALL_DIR      "install"
	DOWNLOAD_COMMAND ""
	CMAKE_ARGS
		-DCMAKE_INSTALL_PREFIX:PATH=${CMAKE_PREFIX_PATH}
		-DCMAKE_MODULE_PATH:PATH=${CMAKE_MODULE_PATH})